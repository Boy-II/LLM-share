# 經貿透視 n8n Workflow 部署指南

## 文件結構

您的專案資料夾現已包含以下檔案：

```
/Volumes/M200/project/經貿透視/
├── 文字處理工作流程.md          # 文字處理完整說明文檔
├── 表格處理工作流程.md          # 表格處理完整說明文檔  
├── 文字處理workflow範本.json    # 文字處理 n8n 工作流程範本
└── 表格處理workflow範本.json    # 表格處理 n8n 工作流程範本
```

## 快速部署步驟

### 1. 準備工作

**Google API 設定：**
- 啟用 Google Drive API 和 Google Docs API
- 建立服務帳號並下載憑證 JSON
- 設定 Google Drive 資料夾權限

**AI 模型設定：**
- 申請 DeepSeek API 金鑰（主要處理模型）
- 申請 Gemini 2.0 Flash API 金鑰（輔助模型，可選）

**資料夾結構：**
```
Google Drive/經貿透視/
├── 文字文檔/          # 上傳待處理的文字文檔
├── 表格文檔/          # 上傳待處理的表格文檔
├── 文字輸出/          # 處理完成的文字文檔輸出
└── 表格輸出/          # 處理完成的表格文檔輸出
```

### 2. n8n 匯入工作流程

1. **匯入文字處理工作流程：**
   - 在 n8n 中點擊 "Import from File"
   - 選擇 `文字處理workflow範本.json`
   - 確認匯入成功

2. **匯入表格處理工作流程：**
   - 在 n8n 中點擊 "Import from File" 
   - 選擇 `表格處理workflow範本.json`
   - 確認匯入成功

### 3. 設定憑證和參數

**每個工作流程都需要設定：**

**Google 憑證：**
- 在 n8n 憑證管理中新增 Google Service Account
- 上傳服務帳號 JSON 檔案
- 測試連線是否正常

**AI 模型憑證：**
- 新增 DeepSeek API 憑證
- 設定 API 端點和金鑰
- 測試模型回應

**資料夾 ID 設定：**
在各個 Google Drive 節點中更新以下參數：
- `監控資料夾ID`：文字文檔/表格文檔資料夾
- `輸出資料夾ID`：對應的輸出資料夾

### 4. 啟用工作流程

1. 檢查所有節點設定是否正確
2. 執行測試運行，確保流程正常
3. 啟用觸發器開始自動處理

## 工作流程說明

### 文字處理工作流程特點

- **自動章節識別**：智能識別P1-P6章節結構
- **格式標準化**：統一字體、間距、對齊設定
- **批量處理**：一次處理完整文檔的所有章節
- **品質控制**：內建品質檢查和驗證機制

**處理流程：**
```
上傳文檔 → 內容分析 → 章節拆分 → AI格式化 → 建立新文檔 → 套用格式 → 品質檢查
```

### 表格處理工作流程特點

- **智能表格識別**：自動判斷T0-T9表格類型  
- **AI驅動校正**：使用DeepSeek進行格式和內容校正
- **專業術語保護**：確保專有名詞不被誤改
- **複雜格式處理**：框線、對齊、顏色等細節處理

**處理流程：**
```
上傳表格 → AI結構分析 → 類型分支 → 格式校正 → 內容清理 → 數字格式化 → 品質驗證
```

## 成本評估

### DeepSeek V2.5 使用成本
- **輸入 Token**：約 $0.14 / 1M tokens
- **輸出 Token**：約 $0.28 / 1M tokens
- **預估單文檔成本**：$0.01 - $0.05（取決於文檔大小）

### 月度成本預估
- **100份文檔/月**：約 $3-5
- **500份文檔/月**：約 $15-25  
- **1000份文檔/月**：約 $30-50

相比 GPT-4，成本節省約 95%。

## 自定義和擴展

### 修改處理規則

1. **更新 Prompt 範本：**
   - 修改 AI 節點中的 prompt 內容
   - 調整格式化規則和校正標準
   - 增加新的處理邏輯

2. **調整章節識別：**
   - 在 Function 節點中修改正規表達式
   - 增加新的章節類型支援
   - 自定義拆分邏輯

3. **擴展表格類型：**
   - 在表格分析 Prompt 中增加新類型
   - 更新類型判斷邏輯
   - 新增對應的處理分支

### 效能優化建議

**批量處理優化：**
- 設定合適的批次大小（建議 1-3 個文檔同時處理）
- 使用 Queue 節點控制並發處理數量
- 設定適當的延遲避免 API 限制

**錯誤處理機制：**
- 在關鍵節點添加錯誤處理分支
- 設定重試機制和回滾邏輯
- 建立處理失敗的通知機制

**監控和日誌：**
- 使用 HTTP Request 節點發送處理狀態
- 建立處理統計和報告
- 設定異常警報機制

## 故障排除

### 常見問題

**1. Google API 連線失敗：**
```
解決方案：
- 檢查服務帳號權限
- 確認 API 已啟用
- 驗證憑證 JSON 格式正確
```

**2. AI 模型回應異常：**
```
解決方案：
- 檢查 API 金鑰是否有效
- 確認 prompt 格式正確
- 調整 temperature 參數
- 檢查輸入 token 數量限制
```

**3. 文檔格式套用失敗：**
```
解決方案：
- 確認 Google Docs API 權限
- 檢查格式參數設定
- 驗證文檔內容格式
```

**4. 章節識別錯誤：**
```
解決方案：
- 檢查正規表達式是否正確
- 確認文檔格式符合預期
- 調整章節識別邏輯
```

### 調試技巧

**啟用詳細日誌：**
- 在 Function 節點中添加 console.log()
- 使用 Set 節點查看中間數據
- 啟用 n8n 執行日誌

**分段測試：**
- 單獨測試每個處理階段
- 使用手動觸發器進行調試
- 檢查每個節點的輸入輸出

**數據驗證：**
- 在關鍵節點添加數據驗證
- 使用 IF 節點進行條件檢查
- 建立數據完整性檢查點

## 維護和更新

### 定期維護任務

**每週檢查：**
- 處理成功率統計
- API 使用量監控
- 錯誤日誌檢查
- 輸出品質抽檢

**每月更新：**
- 檢查 API 版本更新
- 更新格式化規則
- 優化處理效能
- 備份工作流程設定

**季度評估：**
- 全面效能評估
- 成本效益分析
- 功能需求檢討
- 技術架構升級評估

### 版本控制

**工作流程備份：**
- 定期匯出 JSON 檔案
- 建立版本標記系統
- 保存重要修改記錄

**設定文件更新：**
- 同步更新說明文檔
- 記錄參數變更歷史
- 維護操作手冊

## 擴展功能建議

### 進階功能

**1. 智能內容檢查：**
- 建立專業術語資料庫
- 實施一致性檢查
- 自動錯誤修正建議

**2. 批量處理增強：**
- 支援 ZIP 檔案上傳
- 多格式轉換支援
- 並行處理最佳化

**3. 用戶介面：**
- 建立 Web 介面上傳系統
- 處理進度追蹤
- 結果預覽和下載

**4. 報告系統：**
- 自動生成處理報告
- 品質分析統計
- 異常問題追蹤

### 整合建議

**與其他系統整合：**
- SharePoint 文檔庫同步
- 企業 CMS 系統對接
- 電子郵件通知系統
- 資料庫記錄系統

**API 服務化：**
- 包裝為 REST API 服務
- 支援 webhook 調用
- 建立 SDK 和文檔
- 提供 SaaS 服務模式

## 支援資源

### 技術文檔
- [n8n 官方文檔](https://docs.n8n.io/)
- [Google APIs 文檔](https://developers.google.com/docs/api)
- [DeepSeek API 文檔](https://api.deepseek.com/)

### 社群資源
- n8n Community Forum
- GitHub Issues 和 Discussions
- 技術部落格和教學

### 聯絡支援
如需技術協助，請提供：
1. 工作流程執行日誌
2. 錯誤訊息截圖
3. 輸入檔案範例
4. 預期輸出說明

---

## 部署檢查清單

**部署前檢查：**
- [ ] Google API 憑證設定完成
- [ ] DeepSeek API 金鑰有效
- [ ] 資料夾權限設定正確
- [ ] 工作流程匯入成功
- [ ] 所有節點參數已更新
- [ ] 測試執行通過

**上線後檢查：**
- [ ] 觸發器正常運作
- [ ] 文檔處理結果正確
- [ ] 輸出檔案格式符合要求
- [ ] 錯誤處理機制有效
- [ ] 監控系統正常
- [ ] 備份機制建立

**持續監控：**
- [ ] 每日處理量統計
- [ ] API 使用量監控
- [ ] 錯誤率追蹤
- [ ] 處理時間分析
- [ ] 品質檢查結果
- [ ] 用戶滿意度調查

祝您部署順利！如有任何問題，請參考故障排除章節或聯絡技術支援。