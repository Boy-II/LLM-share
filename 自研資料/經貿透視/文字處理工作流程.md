# 經貿透視 - 文字處理工作流程

## 工作流程概述

### 主要功能
- 將 Word 文檔批量轉換為 Google Docs
- 按章節標題自動拆分文檔（P1-P6）
- 統一格式設定和版面配置
- 自動化文字校正和內容標準化

### 流程架構
```
Google Drive Trigger → 文檔讀取 → 內容分析 → 章節拆分 → 格式套用 → 輸出文檔
```

## 技術規格

### 版面設定
- **紙張尺寸**: A4 (595.276 x 841.89 PT)
- **邊界設定**: 上下左右各 1cm (28.35 PT)
- **頁面方向**: 直向

### 文字格式標準
- **字型**: 新細明體 (DFKai-SB)
- **字級**: 12 級
- **顏色**: 黑色 (#000000)
- **對齊方式**: 靠左對齊
- **首行縮排**: 2字元 (約24 PT)

### 段落格式
- **前段距離**: 0行
- **後段距離**: 10點
- **最小行高**: 19.5點 (約1.63倍行距)
- **間距模式**: NEVER_COLLAPSE

## 章節拆分規則

### 標準章節結構
- **P1**: 一、經濟回顧與展望
- **P2**: 二、主要產業概況  
- **P3**: 三、與我國經貿關係
- **P4**: 四、市場環境分析
- **P5**: 五、投資環境分析
- **P6**: 六、拓展建議

### 拆分邏輯
```javascript
// 章節識別正規表達式
const textPattern = /([一二三四五六]+、[^一二三四五六]*?)(?=[一二三四五六]+、|$)/gs;

// 章節標題對應表
const titleMap = {
  '經濟回顧與展望': 'P1',
  '主要產業概況': 'P2', 
  '與我國經貿關係': 'P3',
  '市場環境分析': 'P4',
  '投資環境分析': 'P5',
  '拓展建議': 'P6'
};
```

## n8n 節點配置

### 主要節點序列
1. **Google Drive Trigger** - 監控上傳資料夾
2. **Google Docs (Get Content)** - 讀取文檔內容
3. **Function Node** - 章節分析與拆分
4. **Split In Batches** - 批量處理各章節
5. **Google Docs (Create)** - 建立新文檔
6. **Google Docs (Update)** - 套用內容和格式
7. **Google Docs (Format)** - 最終格式調整

### 關鍵設定參數

#### 版面設定 JSON
```json
{
  "pageSize": {
    "width": {"magnitude": 595.276, "unit": "PT"},
    "height": {"magnitude": 841.89, "unit": "PT"}
  },
  "marginTop": {"magnitude": 28.35, "unit": "PT"},
  "marginBottom": {"magnitude": 28.35, "unit": "PT"},
  "marginLeft": {"magnitude": 28.35, "unit": "PT"},
  "marginRight": {"magnitude": 28.35, "unit": "PT"}
}
```

#### 文字格式 JSON
```json
{
  "textStyle": {
    "fontFamily": "DFKai-SB",
    "fontSize": {"magnitude": 12, "unit": "PT"},
    "foregroundColor": {
      "color": {"rgbColor": {"red": 0, "green": 0, "blue": 0}}
    }
  },
  "paragraphStyle": {
    "alignment": "START",
    "indentFirstLine": {"magnitude": 24, "unit": "PT"},
    "spacingMode": "NEVER_COLLAPSE",
    "spaceAbove": {"magnitude": 0, "unit": "PT"},
    "spaceBelow": {"magnitude": 10, "unit": "PT"},
    "lineSpacing": 1.63
  }
}
```

## 文字校正功能

### JSON 校正規則範例
```json
{
  "corrections": [
    {"find": "舊用詞", "replace": "新用詞"},
    {"find": "錯誤格式", "replace": "正確格式"},
    {"pattern": "\\d{4}-\\d{2}-\\d{2}", "replace": "規範日期格式"}
  ]
}
```

### 校正流程
```
讀取文檔 → 提取文字內容 → JSON 規則比對 → 批量替換 → 寫回文檔
```

## 執行注意事項

### 前置準備
1. 確保 Google Drive 同步設定正確
2. 建立標準的資料夾結構
3. 設定 n8n Google Docs 憑證
4. 準備校正規則 JSON 檔案

### 品質控制
1. 定期檢查拆分結果的準確性
2. 驗證格式套用是否完整
3. 確認章節標題識別正確
4. 檢查文字校正效果

### 錯誤處理
- 建立備份機制
- 設定異常處理流程
- 記錄處理日誌
- 建立恢復機制

## 效能優化建議

### 批量處理策略
- 設定合適的批次大小
- 控制同時處理的文檔數量
- 優化 API 調用頻率
- 使用快取機制提升效率

### 監控與維護
- 定期檢查工作流程狀態
- 監控 API 使用量
- 更新校正規則
- 備份重要設定檔
